<div
  id="footprint-container"
  class="fixed inset-0 pointer-events-none z-[99999] mix-blend-screen"
>
</div>

<script>
  import { gsap } from "gsap";

  const container = document.querySelector("#footprint-container");
  let lastScrollY = 0;
  let isLeftStep = true;

  // ğŸ¾ ëŒ€ê°ì„  ì´ë™ì„ ìœ„í•œ ë³€ìˆ˜ë“¤
  let stepIndex = 0; // ëª‡ ë²ˆì§¸ ë°œê±¸ìŒì¸ì§€ ê¸°ë¡
  const TOTAL_STEPS = 5; // ëª‡ ë²ˆ ê±¸ì–´ì•¼ ëŒ€ê°ì„ ì„ íš¡ë‹¨í•  ê²ƒì¸ê°€
  const STEP_DISTANCE = 200; // ë°œìêµ­ ì‚¬ì´ì˜ ìŠ¤í¬ë¡¤ ê°„ê²©

  const footprintSVG = `
    <svg viewBox="0 0 30 30" style="width: 40px; height: 40px; color: #FBBF24; filter: drop-shadow(0 0 8px rgba(251, 191, 36, 0.6));">
      <circle cx="15" cy="22" r="6" fill="currentColor"/>
      <circle cx="7" cy="12" r="4" fill="currentColor"/>
      <circle cx="15" cy="7" r="4.5" fill="currentColor"/>
      <circle cx="23" cy="12" r="4" fill="currentColor"/>
    </svg>
  `;

  function createFootprint(direction: "up" | "down") {
    if (!container) return;

    const footprint = document.createElement("div");
    footprint.className = "absolute pointer-events-none opacity-0";
    footprint.innerHTML = footprintSVG;

    // ğŸ¾ 1. ëŒ€ê°ì„  ê¸°ë³¸ ê²½ë¡œ ê³„ì‚° (Linear Interpolation)
    const progress = stepIndex / TOTAL_STEPS;

    // ì¢Œí•˜ë‹¨(10, 90) -> ìš°ìƒë‹¨(90, 10) ê²½ë¡œ
    let xPos = 10 + progress * 80;
    let yPos = 90 - progress * 80;

    // ğŸ¾ 2. ê°•ì•„ì§€ì˜ 'ì¢Œìš° ë³´í­' ì¶”ê°€ (Natural Gait)
    const sideOffset = 5; // ì¢Œìš°ë¡œ ë²Œì–´ì§€ëŠ” ì •ë„
    const drift = isLeftStep ? -sideOffset : sideOffset;

    // ëŒ€ê°ì„  ë°©í–¥(45ë„)ì— ìˆ˜ì§ì¸ ë°©í–¥ìœ¼ë¡œ ì‚´ì§ì”© ë²Œë ¤ì¤Œ
    xPos += drift;
    yPos += drift;

    // ğŸ¾ 3. ë¯¸ì„¸í•œ ëœë¤ì„± (ë˜‘ë°”ë¥¸ ì„ ì´ ì•„ë‹ˆê²Œ)
    xPos += (Math.random() - 0.5) * 5;
    yPos += (Math.random() - 0.5) * 5;

    footprint.style.left = `${xPos}%`;
    footprint.style.top = `${yPos}vh`;
    footprint.style.transform = `translate(-50%, -50%)`;

    container.appendChild(footprint);

    // ë‹¤ìŒ ë°œìêµ­ì„ ìœ„í•´ ì¸ë±ìŠ¤ ì¦ê°€ (í•œ ë°”í€´ ë‹¤ ëŒë©´ ì´ˆê¸°í™”)
    stepIndex = (stepIndex + 1) % (TOTAL_STEPS + 1);

    const tl = gsap.timeline({
      onComplete: () => footprint.remove(),
    });

    // ë°©í–¥ì— ë”°ë¼ ë°œìêµ­ ê°ë„ ì¡°ì ˆ (ëŒ€ê°ì„  ë°©í–¥ì¸ -45ë„ ì •ë„ë¡œ ê¸°ë³¸ íšŒì „)
    const baseRotation = -45;

    tl.to(footprint, {
      opacity: 0.8,
      scale: 1,
      startAt: { scale: 1.6, opacity: 0 },
      rotate: baseRotation + (isLeftStep ? -10 : 10),
      duration: 0.4,
      ease: "back.out(2)",
    }).to(footprint, {
      opacity: 0,
      scale: 0.6,
      duration: 2,
      delay: 1.5,
      ease: "power2.inOut",
    });
  }

  const attachToLenis = () => {
    const lenis = (window as any).lenis;
    if (lenis) {
      lenis.on("scroll", ({ scroll }: any) => {
        if (Math.abs(scroll - lastScrollY) > STEP_DISTANCE) {
          createFootprint(scroll > lastScrollY ? "down" : "up");
          lastScrollY = scroll;
          isLeftStep = !isLeftStep;
        }
      });
    } else {
      setTimeout(attachToLenis, 100);
    }
  };

  attachToLenis();
</script>

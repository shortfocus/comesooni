<div
  id="footprint-container"
  class="fixed inset-0 pointer-events-none z-[9999]"
>
</div>

<script>
  import { gsap } from "gsap";

  const container = document.querySelector("#footprint-container");
  let lastScrollY = 0;
  let isLeftStep = true;
  let stepIndex = 0;
  const TOTAL_STEPS = 8;
  const STOP_LIMIT = 800; // 이 지점 이후로는 산책 중단

  // 존재감 있는 크기와 묵직한 다크 그레이 컬러
  const footprintSVG = `
    <svg viewBox="0 0 30 30" style="width: 65px; height: 65px; color: #1A1A1A; opacity: 0.8;">
      <circle cx="15" cy="22" r="6" fill="currentColor"/>
      <circle cx="7" cy="12" r="4" fill="currentColor"/>
      <circle cx="15" cy="7" r="4.5" fill="currentColor"/>
      <circle cx="23" cy="12" r="4" fill="currentColor"/>
    </svg>
  `;

  function createFootprint() {
    if (!container || window.scrollY > STOP_LIMIT) return;

    const footprint = document.createElement("div");
    footprint.className = "absolute pointer-events-none";
    footprint.innerHTML = footprintSVG;

    const progress = stepIndex / TOTAL_STEPS;
    // 대각선 경로: 좌하단 -> 우상단
    let xPos = 15 + progress * 70;
    let yPos = 85 - progress * 70;

    footprint.style.left = `${xPos}%`;
    footprint.style.top = `${yPos}vh`;
    footprint.style.transform = `translate(-50%, -50%)`;

    container.appendChild(footprint);
    stepIndex++;

    gsap.fromTo(
      footprint,
      { scale: 1.3, opacity: 0, rotate: isLeftStep ? -10 : 10 },
      {
        scale: 1,
        opacity: 0.3,
        duration: 0.5,
        ease: "power2.out",
        onComplete: () => {
          gsap.to(footprint, {
            opacity: 0,
            delay: 1.5,
            duration: 1,
            onComplete: () => footprint.remove(),
          });
        },
      },
    );
    isLeftStep = !isLeftStep;
  }

  const attachToLenis = () => {
    const lenis = (window as any).lenis;
    if (lenis) {
      lenis.on("scroll", ({ scroll }: any) => {
        if (Math.abs(scroll - lastScrollY) > 160) {
          createFootprint();
          lastScrollY = scroll;
        }
      });
    } else {
      setTimeout(attachToLenis, 100);
    }
  };

  attachToLenis();
</script>

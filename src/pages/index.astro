---
import Layout from "../layouts/Layout.astro";
import EnhancedFootprints from "../components/animation/EnhancedFootprints.astro";
import Preloader from "../components/animation/Preloader.astro";

// ì•„ì¹´ì´ë¸Œ ë°ì´í„°
const photos = [
  {
    id: 1,
    url: "https://images.unsplash.com/photo-1552053831-71594a27632d?q=80&w=1000",
    title: "ì‚°ì±… ì¤‘ì¸ Comesooni",
    desc: "01 / ARCHIVE",
  },
  {
    id: 2,
    url: "https://images.unsplash.com/photo-1537151608828-ea2b11777ee8?q=80&w=1000",
    title: "ì ìëŠ” Comesooni",
    desc: "02 / ARCHIVE",
  },
  {
    id: 3,
    url: "https://images.unsplash.com/photo-1583337130417-3346a1be7dee?q=80&w=1000",
    title: "ê°„ì‹ ë¨¹ëŠ” Comesooni",
    desc: "03 / ARCHIVE",
  },
  {
    id: 4,
    url: "https://images.unsplash.com/photo-1517849845537-4d257902454a?q=80&w=1000",
    title: "ìµœê³ ì˜ ìˆœê°„",
    desc: "04 / ARCHIVE",
  },
];
---

<Layout title="Comesooni | Digital Archive">
  <Preloader />
  <EnhancedFootprints />

  <main class="bg-[#FAF9F6] text-[#1A1A1A]">
    <section
      class="h-screen flex flex-col items-center justify-center relative overflow-hidden"
    >
      <!-- ë– ë‹¤ë‹ˆëŠ” ë°°ê²½ ì˜¤ë¸Œì íŠ¸ -->
      <div class="absolute inset-0 pointer-events-none opacity-20">
        <div class="floating-obj absolute top-[20%] left-[15%] text-6xl">
          ğŸ¦´
        </div>
        <div class="floating-obj absolute top-[60%] left-[10%] text-5xl">
          ğŸ¾
        </div>
        <div class="floating-obj absolute top-[30%] right-[15%] text-6xl">
          âš½
        </div>
        <div class="floating-obj absolute bottom-[20%] right-[20%] text-7xl">
          ğŸ¦´
        </div>
      </div>

      <h1
        id="hero-text"
        class="text-[14vw] font-black tracking-[calc(-0.06em)] uppercase leading-[0.8] select-none text-[#1A1A1A] z-10 flex"
      >
        Comesooni
      </h1>
      <div class="mt-16 flex items-center gap-6 opacity-30 z-10">
        <span class="w-16 h-[2px] bg-current"></span>
        <p class="text-sm tracking-[0.5em] uppercase font-bold">The Archive</p>
        <span class="w-16 h-[2px] bg-current"></span>
      </div>
    </section>

    <section id="horizontal-gallery" class="relative h-[500vh]">
      <div class="sticky top-0 h-screen flex items-center overflow-hidden">
        <div id="gallery-track" class="flex gap-[12vw] px-[18vw] items-center">
          {
            photos.map((photo) => (
              <div class="gallery-item flex-shrink-0 w-[85vw] md:w-[48vw] group">
                <div class="relative aspect-[16/10] overflow-hidden rounded-sm bg-gray-200 shadow-sm transition-transform duration-700 group-hover:scale-[1.015]">
                  <img
                    src={photo.url}
                    alt={photo.title}
                    class="gallery-img w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-[1.2s] ease-out scale-105 group-hover:scale-100"
                  />
                </div>

                <div class="mt-10 flex justify-between items-end border-b border-black/10 pb-6">
                  <div class="space-y-1">
                    <span class="text-[10px] font-mono tracking-widest opacity-40 block">
                      {photo.desc}
                    </span>
                    <h3 class="text-3xl md:text-4xl font-light italic tracking-tight text-[#222]">
                      {photo.title}
                    </h3>
                  </div>
                  <div class="hidden md:block">
                    <svg
                      width="40"
                      height="40"
                      viewBox="0 0 24 24"
                      fill="none"
                      class="opacity-10 group-hover:opacity-100 transition-opacity duration-500"
                    >
                      <path
                        d="M7 17L17 7M17 7H7M17 7V17"
                        stroke="currentColor"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  </div>
                </div>
              </div>
            ))
          }
        </div>
      </div>
    </section>

    <footer
      id="dynamic-footer"
      class="h-[80vh] flex flex-col items-center justify-center border-t border-black/5 bg-white/50 relative overflow-hidden"
    >
      <div class="text-center space-y-8 z-10">
        <p class="text-[11px] opacity-30 tracking-[0.6em] uppercase">
          Always with Comesooni
        </p>
        <h2
          class="text-4xl md:text-6xl font-black tracking-tighter uppercase opacity-10"
        >
          Comesooni
        </h2>
        <div
          class="flex gap-16 text-[12px] font-bold tracking-[0.2em] opacity-60"
        >
          <a
            href="#"
            class="hover:text-black hover:opacity-100 transition-all cursor-pointer"
            >INSTAGRAM</a
          >
          <a
            href="#"
            class="hover:text-black hover:opacity-100 transition-all cursor-pointer"
            >YOUTUBE</a
          >
          <a
            href="#"
            class="hover:text-black hover:opacity-100 transition-all cursor-pointer"
            >CONTACT</a
          >
        </div>
      </div>

      <!-- ë¹¼ê¼¼ ë‚˜ì˜¤ëŠ” ê¹œìˆœì´ -->
      <div
        id="peeking-dog"
        class="absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-full text-[120px] leading-none z-0 opacity-50"
      >
        ğŸ¶
      </div>
    </footer>
  </main>

  <script>
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";
    gsap.registerPlugin(ScrollTrigger);

    const track = document.querySelector("#gallery-track");

    // íˆì–´ë¡œ í…ìŠ¤íŠ¸ í†µí†µ íŠ€ë©° ë‚˜íƒ€ë‚˜ê²Œ í•˜ê¸° (ê¸€ì í•˜ë‚˜ì”© ë¶„ë¦¬)
    const heroText = document.querySelector("#hero-text");
    if (heroText && heroText.textContent) {
      const chars = heroText.textContent.trim().split("");
      heroText.innerHTML = "";
      chars.forEach((char) => {
        const span = document.createElement("span");
        span.textContent = char;
        span.className = "inline-block";
        heroText.appendChild(span);
      });

      // Preloader ëë‚˜ëŠ” ì‹œê°„ì— ë§ì¶° íˆì–´ë¡œ í…ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
      gsap.fromTo(
        "#hero-text span",
        { y: 100, opacity: 0, rotate: 15 },
        {
          y: 0,
          opacity: 1,
          rotate: 0,
          duration: 0.8,
          stagger: 0.05,
          ease: "back.out(2)",
          delay: 2,
        },
      );
    }

    if (track) {
      // 1. ë©”ì¸ ê°€ë¡œ ìŠ¤í¬ë¡¤ ì„¤ì •
      const horizontalTween = gsap.to(track, {
        x: () =>
          -(track.scrollWidth - window.innerWidth + window.innerWidth * 0.2),
        ease: "none",
        scrollTrigger: {
          trigger: "#horizontal-gallery",
          start: "top top",
          end: "bottom bottom",
          scrub: 1,
          pin: true,
          invalidateOnRefresh: true,
        },
      });

      // 2. ì´ë¯¸ì§€ ê°œë³„ íŒ¨ëŸ´ë™ìŠ¤ & 3D Tilt (ë§ˆìš°ìŠ¤ ë¬´ë¸Œ)
      const images = gsap.utils.toArray(".gallery-img");
      const galleryItems = document.querySelectorAll(".gallery-item");

      images.forEach((img: any) => {
        gsap.to(img, {
          xPercent: -10,
          ease: "none",
          scrollTrigger: {
            trigger: img,
            containerAnimation: horizontalTween,
            start: "left right",
            end: "right left",
            scrub: true,
          },
        });
      });

      // 3D Tilt Effect
      galleryItems.forEach((item: any) => {
        const imgWrapper = item.querySelector("div.relative");

        item.addEventListener("mousemove", (e: MouseEvent) => {
          const rect = item.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;

          const xPct = (x / rect.width - 0.5) * 2; // -1 to 1
          const yPct = (y / rect.height - 0.5) * 2; // -1 to 1

          gsap.to(imgWrapper, {
            rotationY: xPct * 10,
            rotationX: -yPct * 10,
            transformPerspective: 1000,
            ease: "power2.out",
            duration: 0.5,
          });
        });

        item.addEventListener("mouseleave", () => {
          gsap.to(imgWrapper, {
            rotationY: 0,
            rotationX: 0,
            ease: "power3.out",
            duration: 0.8,
          });
        });
      });
    }

    // 3. íˆì–´ë¡œ í…ìŠ¤íŠ¸: ì‚¬ë¼ì§ˆ ë•Œ ìŠ¤ì¼€ì¼ ì—… + ë¸”ëŸ¬ íš¨ê³¼
    gsap.to("#hero-text", {
      y: -120,
      opacity: 0,
      scale: 1.1,
      filter: "blur(25px)",
      scrollTrigger: {
        trigger: "#horizontal-gallery",
        start: "top bottom",
        end: "top top",
        scrub: true,
      },
    });

    // ë°°ê²½ ë¶€ìœ ë¬¼ ë¶€ë“œëŸ¬ìš´ ìƒí•˜ ì´ë™ (ë– ë‹¤ë‹ˆëŠ” íš¨ê³¼)
    gsap.to(".floating-obj", {
      y: "random(-20, 20)",
      rotation: "random(-15, 15)",
      duration: "random(2, 4)",
      repeat: -1,
      yoyo: true,
      ease: "sine.inOut",
      stagger: {
        amount: 2,
        from: "random",
      },
    });

    // 4. í‘¸í„°ì— ë„ë‹¬ ì‹œ ë¹¼ê¼¼ ë‚˜ì˜¤ëŠ” ê¹œìˆœì´ (Peeking Dog)
    gsap.to("#peeking-dog", {
      y: 0,
      opacity: 1,
      ease: "power3.out",
      scrollTrigger: {
        trigger: "#dynamic-footer",
        start: "top bottom",
        end: "bottom bottom",
        scrub: 1,
      },
    });

    // 5. í˜ì´ì§€ ë¡œë“œ ì‹œ ë¦¬í”„ë ˆì‹œ
    window.addEventListener("load", () => {
      ScrollTrigger.refresh();
    });
  </script>
</Layout>

<style>
  /* í…ìŠ¤íŠ¸ ë Œë”ë§ ìµœì í™” */
  body {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  h1 {
    /* Bold í°íŠ¸ê°€ ë” ê½‰ ì°¨ ë³´ì´ê²Œ í•˜ê¸° ìœ„í•œ ë””í…Œì¼ */
    word-spacing: -0.1em;
  }
</style>
